------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function MODULE:CharacterPreSave(character)
    local client = character:getPlayer()
    local SavingEnabled = lia.config.SaveCharacterAmmo
    if IsValid(client) and SavingEnabled then
        local ammoTable = {}
        for _, ammoType in pairs(game.GetAmmoTypes()) do
            local ammoCount = client:GetAmmoCount(ammoType.name)
            if ammoCount > 0 then ammoTable[ammoType.name] = ammoCount end
        end

        character:setData("ammo", ammoTable)
    end
end

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function MODULE:PlayerLoadedChar(client)
    local character = client:getChar()
    local ammoTable = character:getData("ammo", {})
    local SavingEnabled = lia.config.SaveCharacterAmmo
    timer.Simple(
        0.25,
        function()
            if SavingEnabled and IsValid(client) and character then
                for ammoType, ammoCount in pairs(ammoTable) do
                    client:GiveAmmo(ammoCount, ammoType, true)
                end

                character:setData("ammo", nil)
            end
        end
    )
end

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function MODULE:PlayerDeath(client, _, _)
    if not client:getChar() then return end
    local char = client:getChar()
    local inventory = char:getInv()
    local items = inventory:getItems()
    if inventory and not lia.config.KeepAmmoOnDeath then
        for _, v in pairs(items) do
            if (v.isWeapon or v.isCW) and v:getData("equip") then v:setData("ammo", nil) end
        end
    end
end
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------